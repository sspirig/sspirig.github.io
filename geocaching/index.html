
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
<style>
    body {
    padding: 0;
    margin: 0;
}
html, body, #map {
    height: 100%;
    width: 100vw;
}
img {
    position: absolute;
    max-width: 32px;
    max-height: 32px;
}
#camSpace {
    display: none;
}
</style>
<main>
    <h1>GE-ocaching</h1>
    <strong>Les caches du grand genevois</strong>
    <div id='map'>
        
    </div>
    <img src="./cam.png" id="cam" alt="camera">
    <div id="camSpace">
        <button style="height: 5vh;" id="btnShoot">Capturer</button>
        <button style="height: 5vh;" id="btnChange">Changer</button>
        <video id="cameraBox" autoplay></video>
        <canvas id="canvas"></canvas>
    </div>
</main>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
<script type="module">
    ///////////// PARTIE MAP
    var map = L.map('map').setView([46.204391, 6.143158], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' }).addTo(map);

    const marker1 = L.marker([46.504391, 6.143158]).addTo(map);

    ///////////// PARTIE CAMERA
    let stream = await navigator.mediaDevices.getUserMedia({video: true});
    let isCamOpened = false;
    let cameraBox = document.querySelector("#cameraBox");
    let canvas = document.querySelector("#canvas");
    let btnOpenCamera = document.querySelector("#cam");
    let btnTakePicture = document.querySelector("#btnShoot");
    let btnChangeCamera  = document.querySelector("#btnChange");
    let camSpace = document.querySelector("#camSpace");

    canvas.width = cameraBox.videoWidth;
    canvas.height = cameraBox.videoHeight;

    let constraints = {
        video: {
        width: { ideal: 1280 },
        height: { ideal: 720 },
        facingMode: { exact: "environment" }
        }
    };

    btnOpenCamera.addEventListener("click", () => {
        
        if (!isCamOpened) {
            isCamOpened = true;
            camSpace.style.display = "block";
            cameraBox.srcObject = stream;
        }
        else {
            isCamOpened = false;
            camSpace.style.display = "none";
            cameraBox.srcObject = {};
        }
    });
    btnTakePicture.addEventListener("click", () => {
        canvas.width = cameraBox.videoWidth;
        canvas.height = cameraBox.videoHeight;
        canvas.getContext("2d").drawImage(cameraBox, 0, 0);
        print(canvas.getDataURL());
    });
    btnChangeCamera.addEventListener("click", () => {
        constraints.facingMode.exact = "selfie";
    });

    
</script>